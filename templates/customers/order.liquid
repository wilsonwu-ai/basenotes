{%- layout 'theme' -%}

<section class="section" style="padding-top: calc(var(--header-height) + var(--spacing-2xl));">
  <div class="container">
    <div class="account-layout">

      {% comment %} Sidebar Navigation {% endcomment %}
      <aside class="account-sidebar">
        <div style="margin-bottom: var(--spacing-xl);">
          <p style="font-size: var(--font-size-sm); color: var(--color-text-light);">Welcome back,</p>
          <p style="font-size: var(--font-size-xl); font-family: var(--font-heading);">{{ customer.first_name }}</p>
        </div>

        <ul class="account-nav">
          <li class="account-nav__item">
            <a href="{{ routes.account_url }}" class="account-nav__link">Dashboard</a>
          </li>
          <li class="account-nav__item">
            <a href="{{ routes.account_url }}#orders" class="account-nav__link is-active">Order History</a>
          </li>
          <li class="account-nav__item">
            <a href="{{ routes.account_addresses_url }}" class="account-nav__link">Addresses</a>
          </li>
          <li class="account-nav__item">
            <a href="#subscription" class="account-nav__link">My Subscription</a>
          </li>
          <li class="account-nav__item">
            <a href="#queue" class="account-nav__link">Fragrance Queue</a>
          </li>
        </ul>

        <div style="margin-top: var(--spacing-xl); padding-top: var(--spacing-xl); border-top: 1px solid var(--color-border);">
          <a href="{{ routes.account_logout_url }}" style="font-size: var(--font-size-sm); color: var(--color-text-light);">
            Sign Out
          </a>
        </div>
      </aside>

      {% comment %} Main Content {% endcomment %}
      <main class="account-content">
        <div style="margin-bottom: var(--spacing-lg);">
          <a href="{{ routes.account_url }}" style="font-size: var(--font-size-sm); color: var(--color-secondary);">
            &larr; Back to Account
          </a>
        </div>

        <div class="account-header">
          <h1 class="account-header__title">Order {{ order.name }}</h1>
          <p class="account-header__subtitle">
            Placed on {{ order.created_at | date: '%B %d, %Y at %I:%M %p' }}
          </p>
        </div>

        {% comment %} Order Status {% endcomment %}
        <div style="display: flex; gap: var(--spacing-lg); margin-bottom: var(--spacing-2xl);">
          <div style="padding: var(--spacing-md) var(--spacing-lg); background: var(--color-background-secondary);">
            <span style="font-size: var(--font-size-xs); text-transform: uppercase; letter-spacing: 0.1em; color: var(--color-text-light);">Payment</span>
            <span style="display: block; font-weight: 500; margin-top: var(--spacing-xs);">
              {{ order.financial_status_label }}
            </span>
          </div>
          <div style="padding: var(--spacing-md) var(--spacing-lg); background: var(--color-background-secondary);">
            <span style="font-size: var(--font-size-xs); text-transform: uppercase; letter-spacing: 0.1em; color: var(--color-text-light);">Fulfillment</span>
            <span style="display: block; font-weight: 500; margin-top: var(--spacing-xs);">
              {{ order.fulfillment_status_label | default: 'Processing' }}
            </span>
          </div>
        </div>

        {% comment %} Order Items {% endcomment %}
        <div style="border: 1px solid var(--color-border); margin-bottom: var(--spacing-2xl);">
          <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--color-border); background: var(--color-background-secondary);">
            <h2 style="font-size: var(--font-size-lg); margin: 0;">Items Ordered</h2>
          </div>

          {%- for line_item in order.line_items -%}
            <div style="display: flex; gap: var(--spacing-lg); padding: var(--spacing-lg); border-bottom: 1px solid var(--color-border);{% if forloop.last %}border-bottom: none;{% endif %}">
              <div style="width: 80px; height: 100px; background: var(--color-background-secondary); flex-shrink: 0;">
                {%- if line_item.image -%}
                  <img
                    src="{{ line_item.image | image_url: width: 200 }}"
                    alt="{{ line_item.title }}"
                    style="width: 100%; height: 100%; object-fit: cover;"
                  >
                {%- endif -%}
              </div>
              <div style="flex: 1;">
                <h3 style="font-size: var(--font-size-base); margin-bottom: var(--spacing-xs);">
                  {%- if line_item.product.url -%}
                    <a href="{{ line_item.product.url }}">{{ line_item.product.title }}</a>
                  {%- else -%}
                    {{ line_item.title }}
                  {%- endif -%}
                </h3>
                {%- if line_item.variant.title != 'Default Title' -%}
                  <p style="font-size: var(--font-size-sm); color: var(--color-text-light);">{{ line_item.variant.title }}</p>
                {%- endif -%}
                <p style="font-size: var(--font-size-sm); color: var(--color-text-light);">Qty: {{ line_item.quantity }}</p>

                {%- if line_item.fulfillment -%}
                  <div style="margin-top: var(--spacing-sm);">
                    <span style="font-size: var(--font-size-xs); text-transform: uppercase; color: var(--color-success);">
                      Shipped
                    </span>
                    {%- if line_item.fulfillment.tracking_url -%}
                      <a href="{{ line_item.fulfillment.tracking_url }}" target="_blank" style="font-size: var(--font-size-xs); color: var(--color-secondary); margin-left: var(--spacing-sm);">
                        Track Package &rarr;
                      </a>
                    {%- endif -%}
                  </div>
                {%- endif -%}
              </div>
              <div style="text-align: right;">
                <span style="font-weight: 500;">{{ line_item.final_line_price | money }}</span>
              </div>
            </div>
          {%- endfor -%}
        </div>

        {% comment %} Order Summary & Addresses {% endcomment %}
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-2xl);">
          {% comment %} Summary {% endcomment %}
          <div>
            <h3 style="font-size: var(--font-size-lg); margin-bottom: var(--spacing-lg);">Order Summary</h3>
            <div style="background: var(--color-background-secondary); padding: var(--spacing-lg);">
              <div style="display: flex; justify-content: space-between; padding: var(--spacing-sm) 0; border-bottom: 1px solid var(--color-border);">
                <span>Subtotal</span>
                <span>{{ order.line_items_subtotal_price | money }}</span>
              </div>

              {%- for discount_application in order.cart_level_discount_applications -%}
                <div style="display: flex; justify-content: space-between; padding: var(--spacing-sm) 0; border-bottom: 1px solid var(--color-border); color: var(--color-success);">
                  <span>Discount ({{ discount_application.title }})</span>
                  <span>-{{ discount_application.total_allocated_amount | money }}</span>
                </div>
              {%- endfor -%}

              {%- for shipping_method in order.shipping_methods -%}
                <div style="display: flex; justify-content: space-between; padding: var(--spacing-sm) 0; border-bottom: 1px solid var(--color-border);">
                  <span>Shipping ({{ shipping_method.title }})</span>
                  <span>{{ shipping_method.price | money }}</span>
                </div>
              {%- endfor -%}

              <div style="display: flex; justify-content: space-between; padding: var(--spacing-sm) 0; border-bottom: 1px solid var(--color-border);">
                <span>Tax</span>
                <span>{{ order.tax_price | money }}</span>
              </div>

              <div style="display: flex; justify-content: space-between; padding: var(--spacing-md) 0; font-size: var(--font-size-lg); font-weight: 600;">
                <span>Total</span>
                <span>{{ order.total_price | money }}</span>
              </div>
            </div>
          </div>

          {% comment %} Addresses {% endcomment %}
          <div>
            <h3 style="font-size: var(--font-size-lg); margin-bottom: var(--spacing-lg);">Shipping Address</h3>
            <div style="background: var(--color-background-secondary); padding: var(--spacing-lg);">
              <p>{{ order.shipping_address.first_name }} {{ order.shipping_address.last_name }}</p>
              <p style="color: var(--color-text-light);">
                {%- if order.shipping_address.company != blank -%}{{ order.shipping_address.company }}<br>{%- endif -%}
                {{ order.shipping_address.address1 }}<br>
                {%- if order.shipping_address.address2 != blank -%}{{ order.shipping_address.address2 }}<br>{%- endif -%}
                {{ order.shipping_address.city }}, {{ order.shipping_address.province_code }} {{ order.shipping_address.zip }}<br>
                {{ order.shipping_address.country }}
              </p>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>
</section>
