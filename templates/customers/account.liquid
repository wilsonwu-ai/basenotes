{%- layout 'theme' -%}

<section class="account-section">
  <div class="container">
    <div class="account-layout">

      {% comment %} Sidebar Navigation {% endcomment %}
      <aside class="account-sidebar">
        <div class="account-user">
          <div class="account-user__avatar">
            {{ customer.first_name | slice: 0 }}{{ customer.last_name | slice: 0 }}
          </div>
          <div class="account-user__info">
            <p class="account-user__greeting">Welcome back,</p>
            <p class="account-user__name">{{ customer.first_name }} {{ customer.last_name }}</p>
            <p class="account-user__email">{{ customer.email }}</p>
          </div>
        </div>

        <nav class="account-nav">
          <a href="{{ routes.account_url }}" class="account-nav__link is-active">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="7" height="7"/>
              <rect x="14" y="3" width="7" height="7"/>
              <rect x="14" y="14" width="7" height="7"/>
              <rect x="3" y="14" width="7" height="7"/>
            </svg>
            Dashboard
          </a>
          <a href="#subscription" class="account-nav__link" data-scroll>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
            </svg>
            My Subscription
          </a>
          <a href="#queue" class="account-nav__link" data-scroll>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="8" y1="6" x2="21" y2="6"/>
              <line x1="8" y1="12" x2="21" y2="12"/>
              <line x1="8" y1="18" x2="21" y2="18"/>
              <line x1="3" y1="6" x2="3.01" y2="6"/>
              <line x1="3" y1="12" x2="3.01" y2="12"/>
              <line x1="3" y1="18" x2="3.01" y2="18"/>
            </svg>
            Fragrance Queue
          </a>
          <a href="#orders" class="account-nav__link" data-scroll>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/>
              <path d="M3 6h18"/>
              <path d="M16 10a4 4 0 0 1-8 0"/>
            </svg>
            Order History
          </a>
          <a href="{{ routes.account_addresses_url }}" class="account-nav__link">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
              <circle cx="12" cy="10" r="3"/>
            </svg>
            Addresses
          </a>
          <a href="#preferences" class="account-nav__link" data-scroll>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="3"/>
              <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
            </svg>
            Scent Preferences
          </a>
        </nav>

        <div class="account-sidebar__footer">
          <a href="{{ routes.account_logout_url }}" class="account-logout">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
              <polyline points="16 17 21 12 16 7"/>
              <line x1="21" y1="12" x2="9" y2="12"/>
            </svg>
            Sign Out
          </a>
        </div>
      </aside>

      {% comment %} Main Content {% endcomment %}
      <main class="account-main">

        {% comment %} Subscription Status Card {% endcomment %}
        <section id="subscription" class="account-card account-card--featured">
          {%- if customer.tags contains 'subscriber' or customer.tags contains 'active_subscriber' -%}
            {%- comment -%} Active Subscriber View {%- endcomment -%}
            <div class="subscription-header">
              <div class="subscription-info">
                <span class="subscription-badge">Active Subscription</span>
                <h2 class="subscription-plan">Monthly Plan</h2>
                <p class="subscription-next">Manage your subscription below</p>
              </div>
              <div class="subscription-price">
                <span class="subscription-price__amount">{{ settings.subscription_price | default: '$20' }}</span>
                <span class="subscription-price__period">/month</span>
              </div>
            </div>

            <div class="subscription-actions">
              {%- if settings.subscription_manage_url != blank -%}
                <a href="{{ settings.subscription_manage_url }}" class="btn btn--outline-light btn--small">Manage Plan</a>
              {%- else -%}
                <a href="/pages/contact" class="btn btn--outline-light btn--small">Contact Support</a>
              {%- endif -%}
              <a href="/collections/all" class="btn btn--gold btn--small">Browse Fragrances</a>
            </div>

            <div class="subscription-next-scent">
              <p class="subscription-next-scent__label">Questions about your subscription?</p>
              <p style="font-size: var(--font-size-sm); opacity: 0.8;">
                Contact us at <a href="mailto:hello@basenotes.com" style="color: var(--color-secondary);">hello@basenotes.com</a> or visit our <a href="/pages/faq" style="color: var(--color-secondary);">FAQ page</a>.
              </p>
            </div>
          {%- else -%}
            {%- comment -%} Non-Subscriber View {%- endcomment -%}
            <div class="subscription-header">
              <div class="subscription-info">
                <span class="subscription-badge" style="background: rgba(255,255,255,0.2); color: white;">Start Your Journey</span>
                <h2 class="subscription-plan">Join Basenotes</h2>
                <p class="subscription-next">Get a new luxury fragrance every month</p>
              </div>
              <div class="subscription-price">
                <span class="subscription-price__amount">{{ settings.subscription_price | default: '$20' }}</span>
                <span class="subscription-price__period">/month</span>
              </div>
            </div>

            <ul class="subscription-benefits" style="list-style: none; padding: 0; margin: 0 0 var(--spacing-xl); opacity: 0.9;">
              <li style="display: flex; align-items: center; gap: var(--spacing-sm); margin-bottom: var(--spacing-sm); font-size: var(--font-size-sm);">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--color-secondary)" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                5ml atomizer of premium fragrance
              </li>
              <li style="display: flex; align-items: center; gap: var(--spacing-sm); margin-bottom: var(--spacing-sm); font-size: var(--font-size-sm);">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--color-secondary)" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                Free shipping on all orders
              </li>
              <li style="display: flex; align-items: center; gap: var(--spacing-sm); margin-bottom: var(--spacing-sm); font-size: var(--font-size-sm);">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--color-secondary)" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                Pause or cancel anytime
              </li>
            </ul>

            <div class="subscription-actions">
              <a href="/pages/subscription" class="btn btn--gold btn--large">Start Your Subscription</a>
              <a href="/pages/quiz" class="btn btn--outline-light btn--small" style="margin-left: var(--spacing-sm);">Take the Quiz</a>
            </div>
          {%- endif -%}
        </section>

        {% comment %} Quick Stats {% endcomment %}
        <div class="account-stats">
          <div class="account-stat">
            <span class="account-stat__number">{{ customer.orders_count }}</span>
            <span class="account-stat__label">Orders</span>
          </div>
          <div class="account-stat">
            <span class="account-stat__number" id="queueCountStat">0</span>
            <span class="account-stat__label">In Queue</span>
          </div>
          <div class="account-stat">
            {%- assign member_since = customer.created_at | date: '%s' -%}
            {%- assign now = 'now' | date: '%s' -%}
            {%- assign diff_seconds = now | minus: member_since -%}
            {%- assign months_active = diff_seconds | divided_by: 2592000 -%}
            {%- if months_active < 1 -%}{%- assign months_active = 1 -%}{%- endif -%}
            <span class="account-stat__number">{{ months_active }}</span>
            <span class="account-stat__label">Months Active</span>
          </div>
          <div class="account-stat">
            <span class="account-stat__number" id="wishlistCountStat">0</span>
            <span class="account-stat__label">Wishlist</span>
          </div>
        </div>

        {% comment %} Fragrance Queue {% endcomment %}
        <section id="queue" class="account-card">
          <div class="account-card__header">
            <h3 class="account-card__title">Your Fragrance Queue</h3>
            <a href="/collections/all" class="text-link">Add More</a>
          </div>

          <div class="queue-list" id="queueList">
            {%- comment -%} Queue items will be populated by JavaScript from localStorage {%- endcomment -%}
          </div>

          <div class="queue-empty" id="queueEmpty" style="display: none;">
            <div class="empty-state">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                <line x1="8" y1="6" x2="21" y2="6"/>
                <line x1="8" y1="12" x2="21" y2="12"/>
                <line x1="8" y1="18" x2="21" y2="18"/>
                <line x1="3" y1="6" x2="3.01" y2="6"/>
                <line x1="3" y1="12" x2="3.01" y2="12"/>
                <line x1="3" y1="18" x2="3.01" y2="18"/>
              </svg>
              <p>Your fragrance queue is empty</p>
              <p style="font-size: var(--font-size-sm); color: var(--color-text-muted); margin-bottom: var(--spacing-lg);">
                Browse our collection and add fragrances to build your queue
              </p>
              <a href="/collections/all" class="btn btn--primary">Browse Fragrances</a>
            </div>
          </div>
        </section>

        {% comment %} Recent Orders {% endcomment %}
        <section id="orders" class="account-card">
          <div class="account-card__header">
            <h3 class="account-card__title">Recent Orders</h3>
          </div>

          {%- if customer.orders.size > 0 -%}
            <div class="orders-list">
              {%- for order in customer.orders limit: 5 -%}
                <a href="{{ order.customer_url }}" class="order-item">
                  <div class="order-item__info">
                    <span class="order-item__number">{{ order.name }}</span>
                    <span class="order-item__date">{{ order.created_at | date: '%B %d, %Y' }}</span>
                  </div>
                  <div class="order-item__status">
                    <span class="order-status order-status--{{ order.fulfillment_status | default: 'processing' }}">
                      {{ order.fulfillment_status_label | default: 'Processing' }}
                    </span>
                  </div>
                  <div class="order-item__total">
                    {{ order.total_price | money }}
                  </div>
                  <svg class="order-item__arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="9 18 15 12 9 6"/>
                  </svg>
                </a>
              {%- endfor -%}
            </div>
          {%- else -%}
            <div class="empty-state">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                <path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/>
                <path d="M3 6h18"/>
                <path d="M16 10a4 4 0 0 1-8 0"/>
              </svg>
              <p>No orders yet</p>
              <a href="/collections/all" class="btn btn--primary">Start Shopping</a>
            </div>
          {%- endif -%}
        </section>

        {% comment %} Default Address {% endcomment %}
        {%- if customer.default_address -%}
          <section class="account-card">
            <div class="account-card__header">
              <h3 class="account-card__title">Shipping Address</h3>
              <a href="{{ routes.account_addresses_url }}" class="text-link">Edit</a>
            </div>
            <div class="address-display">
              <p class="address-display__name">{{ customer.default_address.first_name }} {{ customer.default_address.last_name }}</p>
              <p class="address-display__line">{{ customer.default_address.address1 }}</p>
              {%- if customer.default_address.address2 != blank -%}
                <p class="address-display__line">{{ customer.default_address.address2 }}</p>
              {%- endif -%}
              <p class="address-display__line">{{ customer.default_address.city }}, {{ customer.default_address.province_code }} {{ customer.default_address.zip }}</p>
              <p class="address-display__line">{{ customer.default_address.country }}</p>
            </div>
          </section>
        {%- endif -%}

      </main>
    </div>
  </div>
</section>

<style>
  .account-section {
    padding-top: calc(var(--header-height) + var(--spacing-2xl));
    padding-bottom: var(--spacing-4xl);
    min-height: 100vh;
    background: var(--color-background-secondary);
  }

  .account-layout {
    display: grid;
    grid-template-columns: 280px 1fr;
    gap: var(--spacing-2xl);
  }

  /* Sidebar */
  .account-sidebar {
    background: white;
    border-radius: var(--radius-lg);
    padding: var(--spacing-xl);
    height: fit-content;
    position: sticky;
    top: calc(var(--header-height) + var(--spacing-xl));
  }

  .account-user {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    padding-bottom: var(--spacing-xl);
    border-bottom: 1px solid var(--color-border);
    margin-bottom: var(--spacing-xl);
  }

  .account-user__avatar {
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--color-primary);
    color: white;
    border-radius: 50%;
    font-weight: 600;
    font-size: var(--font-size-sm);
  }

  .account-user__greeting {
    font-size: var(--font-size-xs);
    color: var(--color-text-light);
  }

  .account-user__name {
    font-weight: 600;
    font-size: var(--font-size-base);
  }

  .account-user__email {
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
  }

  .account-nav {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
  }

  .account-nav__link {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    padding: var(--spacing-sm) var(--spacing-md);
    border-radius: var(--radius-md);
    font-size: var(--font-size-sm);
    color: var(--color-text-light);
    transition: all 0.2s;
  }

  .account-nav__link svg {
    width: 18px;
    height: 18px;
  }

  .account-nav__link:hover {
    background: var(--color-background-secondary);
    color: var(--color-primary);
  }

  .account-nav__link.is-active {
    background: var(--color-primary);
    color: white;
  }

  .account-sidebar__footer {
    margin-top: var(--spacing-xl);
    padding-top: var(--spacing-xl);
    border-top: 1px solid var(--color-border);
  }

  .account-logout {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
  }

  .account-logout svg {
    width: 16px;
    height: 16px;
  }

  /* Main Content */
  .account-main {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xl);
  }

  .account-card {
    background: white;
    border-radius: var(--radius-lg);
    padding: var(--spacing-xl);
  }

  .account-card--featured {
    background: linear-gradient(135deg, var(--color-primary) 0%, #2a2a2a 100%);
    color: white;
  }

  .account-card__header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-lg);
  }

  .account-card__title {
    font-size: var(--font-size-xl);
    font-weight: 600;
  }

  .text-link {
    color: var(--color-secondary);
    font-size: var(--font-size-sm);
    font-weight: 500;
  }

  /* Subscription Card */
  .subscription-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: var(--spacing-xl);
  }

  .subscription-badge {
    display: inline-block;
    padding: 4px 12px;
    background: var(--color-secondary);
    color: var(--color-primary);
    font-size: var(--font-size-xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border-radius: var(--radius-full);
    margin-bottom: var(--spacing-sm);
  }

  .subscription-plan {
    font-size: var(--font-size-2xl);
    margin-bottom: var(--spacing-xs);
  }

  .subscription-next {
    opacity: 0.8;
    font-size: var(--font-size-sm);
  }

  .subscription-price__amount {
    font-size: var(--font-size-4xl);
    font-weight: 700;
  }

  .subscription-price__period {
    opacity: 0.7;
  }

  .subscription-actions {
    display: flex;
    gap: var(--spacing-sm);
    margin-bottom: var(--spacing-xl);
  }

  .subscription-next-scent {
    padding-top: var(--spacing-xl);
    border-top: 1px solid rgba(255, 255, 255, 0.2);
  }

  .subscription-next-scent__label {
    font-size: var(--font-size-xs);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    opacity: 0.7;
    margin-bottom: var(--spacing-md);
  }

  .subscription-next-scent__product {
    display: flex;
    align-items: center;
    gap: var(--spacing-lg);
  }

  .subscription-next-scent__image {
    width: 60px;
    height: 80px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .subscription-next-scent__image svg {
    width: 40px;
    opacity: 0.6;
  }

  .subscription-next-scent__details h4 {
    font-size: var(--font-size-lg);
    margin-bottom: var(--spacing-xs);
  }

  .subscription-next-scent__details p {
    font-size: var(--font-size-sm);
    opacity: 0.7;
    margin-bottom: var(--spacing-sm);
  }

  /* Stats */
  .account-stats {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--spacing-md);
  }

  .account-stat {
    background: white;
    border-radius: var(--radius-lg);
    padding: var(--spacing-xl);
    text-align: center;
  }

  .account-stat__number {
    display: block;
    font-size: var(--font-size-3xl);
    font-weight: 700;
    color: var(--color-secondary);
    margin-bottom: var(--spacing-xs);
  }

  .account-stat__label {
    font-size: var(--font-size-sm);
    color: var(--color-text-light);
  }

  /* Queue */
  .queue-list {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
  }

  .queue-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    padding: var(--spacing-md);
    background: var(--color-background-secondary);
    border-radius: var(--radius-md);
  }

  .queue-item__position {
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--color-secondary);
    color: var(--color-primary);
    border-radius: 50%;
    font-weight: 700;
    font-size: var(--font-size-sm);
  }

  .queue-item__image {
    width: 50px;
    height: 60px;
    background: white;
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .queue-item__image svg {
    width: 30px;
    color: var(--color-text-muted);
  }

  .queue-item__details {
    flex: 1;
  }

  .queue-item__details h4 {
    font-size: var(--font-size-base);
    font-weight: 600;
    margin-bottom: 2px;
  }

  .queue-item__details p {
    font-size: var(--font-size-sm);
    color: var(--color-text-light);
  }

  .queue-item__actions {
    display: flex;
    gap: var(--spacing-xs);
  }

  .queue-item__move,
  .queue-item__remove {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: all 0.2s;
  }

  .queue-item__move svg,
  .queue-item__remove svg {
    width: 16px;
    height: 16px;
    color: var(--color-text-muted);
  }

  .queue-item__move:hover {
    border-color: var(--color-secondary);
  }

  .queue-item__remove:hover {
    border-color: var(--color-error);
  }

  .queue-item__remove:hover svg {
    color: var(--color-error);
  }

  /* Orders */
  .orders-list {
    display: flex;
    flex-direction: column;
  }

  .order-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-lg);
    padding: var(--spacing-md) 0;
    border-bottom: 1px solid var(--color-border);
    transition: background 0.2s;
  }

  .order-item:last-child {
    border-bottom: none;
  }

  .order-item:hover {
    background: var(--color-background-secondary);
    margin: 0 calc(-1 * var(--spacing-md));
    padding-left: var(--spacing-md);
    padding-right: var(--spacing-md);
  }

  .order-item__info {
    flex: 1;
  }

  .order-item__number {
    font-weight: 600;
    display: block;
  }

  .order-item__date {
    font-size: var(--font-size-sm);
    color: var(--color-text-light);
  }

  .order-status {
    padding: 4px 10px;
    font-size: var(--font-size-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border-radius: var(--radius-full);
  }

  .order-status--fulfilled {
    background: rgba(76, 175, 80, 0.1);
    color: var(--color-success);
  }

  .order-status--unfulfilled,
  .order-status--processing {
    background: rgba(201, 168, 108, 0.1);
    color: var(--color-secondary);
  }

  .order-item__total {
    font-weight: 600;
  }

  .order-item__arrow {
    width: 16px;
    height: 16px;
    color: var(--color-text-muted);
  }

  /* Empty State */
  .empty-state {
    text-align: center;
    padding: var(--spacing-3xl);
  }

  .empty-state svg {
    width: 48px;
    height: 48px;
    color: var(--color-text-muted);
    margin-bottom: var(--spacing-md);
  }

  .empty-state p {
    color: var(--color-text-light);
    margin-bottom: var(--spacing-lg);
  }

  /* Address */
  .address-display {
    color: var(--color-text-light);
  }

  .address-display__name {
    font-weight: 600;
    color: var(--color-text);
    margin-bottom: var(--spacing-sm);
  }

  .address-display__line {
    margin: 0;
    line-height: 1.6;
  }

  /* Responsive */
  @media (max-width: 992px) {
    .account-layout {
      grid-template-columns: 1fr;
    }

    .account-sidebar {
      position: static;
      order: -1;
    }

    .account-nav {
      flex-direction: row;
      flex-wrap: wrap;
    }

    .account-stats {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 576px) {
    .subscription-header {
      flex-direction: column;
      gap: var(--spacing-lg);
    }

    .subscription-actions {
      flex-wrap: wrap;
    }

    .account-stats {
      grid-template-columns: repeat(2, 1fr);
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Smooth scroll for anchor links
    document.querySelectorAll('[data-scroll]').forEach(link => {
      link.addEventListener('click', function(e) {
        const href = this.getAttribute('href');
        if (href.startsWith('#')) {
          e.preventDefault();
          const target = document.querySelector(href);
          if (target) {
            target.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        }
      });
    });

    // Queue Management
    const queueList = document.getElementById('queueList');
    const queueEmpty = document.getElementById('queueEmpty');
    const queueCountStat = document.getElementById('queueCountStat');
    const wishlistCountStat = document.getElementById('wishlistCountStat');

    function getQueue() {
      try {
        return JSON.parse(localStorage.getItem('basenotes_queue') || '[]');
      } catch (e) {
        return [];
      }
    }

    function saveQueue(queue) {
      localStorage.setItem('basenotes_queue', JSON.stringify(queue));
      renderQueue();
    }

    function getWishlist() {
      try {
        return JSON.parse(localStorage.getItem('basenotes_wishlist') || '[]');
      } catch (e) {
        return [];
      }
    }

    function renderQueue() {
      const queue = getQueue();

      // Update stats
      if (queueCountStat) {
        queueCountStat.textContent = queue.length;
      }

      if (wishlistCountStat) {
        wishlistCountStat.textContent = getWishlist().length;
      }

      if (queue.length === 0) {
        queueList.style.display = 'none';
        queueEmpty.style.display = 'block';
        return;
      }

      queueList.style.display = 'flex';
      queueEmpty.style.display = 'none';

      queueList.innerHTML = queue.map((item, index) => `
        <div class="queue-item" data-index="${index}">
          <div class="queue-item__position">${index + 1}</div>
          <div class="queue-item__image">
            ${item.image ? `<img src="${item.image}" alt="${item.title}" style="width: 100%; height: 100%; object-fit: cover;">` : `
              <svg viewBox="0 0 60 100" fill="none" stroke="currentColor" stroke-width="1">
                <rect x="15" y="25" width="30" height="65" rx="3"/>
                <rect x="20" y="10" width="20" height="15"/>
                <rect x="25" y="2" width="10" height="8" rx="2"/>
              </svg>
            `}
          </div>
          <div class="queue-item__details">
            <h4><a href="${item.url || '#'}" style="color: inherit; text-decoration: none;">${item.title}</a></h4>
            <p>${item.vendor || ''}</p>
          </div>
          <div class="queue-item__actions">
            ${index > 0 ? `
              <button class="queue-item__move" title="Move up" data-action="move-up" data-index="${index}">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="18 15 12 9 6 15"/>
                </svg>
              </button>
            ` : ''}
            <button class="queue-item__remove" title="Remove" data-action="remove" data-index="${index}">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
              </svg>
            </button>
          </div>
        </div>
      `).join('');

      // Attach event listeners
      queueList.querySelectorAll('[data-action="move-up"]').forEach(btn => {
        btn.addEventListener('click', function() {
          const index = parseInt(this.dataset.index);
          moveQueueItem(index, index - 1);
        });
      });

      queueList.querySelectorAll('[data-action="remove"]').forEach(btn => {
        btn.addEventListener('click', function() {
          const index = parseInt(this.dataset.index);
          removeFromQueue(index);
        });
      });
    }

    function moveQueueItem(fromIndex, toIndex) {
      const queue = getQueue();
      if (toIndex < 0 || toIndex >= queue.length) return;

      const item = queue.splice(fromIndex, 1)[0];
      queue.splice(toIndex, 0, item);
      saveQueue(queue);
    }

    function removeFromQueue(index) {
      const queue = getQueue();
      queue.splice(index, 1);
      saveQueue(queue);
    }

    // Initialize queue
    renderQueue();

    // Make addToQueue available globally for product pages
    window.addToQueue = function(product) {
      const queue = getQueue();
      // Check if already in queue
      if (!queue.find(item => item.id === product.id)) {
        queue.push({
          id: product.id,
          title: product.title,
          vendor: product.vendor || '',
          url: product.url || `/products/${product.handle}`,
          image: product.image || ''
        });
        saveQueue(queue);
        alert('Added to your queue!');
      } else {
        alert('This fragrance is already in your queue.');
      }
    };
  });
</script>
