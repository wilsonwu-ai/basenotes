{%- liquid
  assign transparent_header = false
  if template.name == 'index'
    assign transparent_header = section.settings.transparent_on_homepage
  endif
-%}

{% comment %} Announcement Bar {% endcomment %}
{%- if section.settings.announcement_enabled and section.settings.announcement_text != blank -%}
<div class="announcement-bar">
  <div class="container">
    <p class="announcement-bar__text">
      {%- if section.settings.announcement_link != blank -%}
        <a href="{{ section.settings.announcement_link }}">{{ section.settings.announcement_text }}</a>
      {%- else -%}
        {{ section.settings.announcement_text }}
      {%- endif -%}
    </p>
  </div>
</div>
{%- endif -%}

<header class="header{% if transparent_header %} is-transparent{% endif %}{% if section.settings.sticky_header %} is-sticky{% endif %}" data-header>
  <div class="header__inner container">
    {% comment %} Mobile Menu Toggle {% endcomment %}
    <button class="header__menu-toggle" data-mobile-toggle aria-label="Open menu">
      <span class="header__hamburger">
        <span></span>
        <span></span>
        <span></span>
      </span>
    </button>

    {% comment %} Logo {% endcomment %}
    <div class="header__logo">
      <a href="{{ routes.root_url }}">
        {%- if section.settings.logo != blank -%}
          <img
            src="{{ section.settings.logo | image_url: width: 300 }}"
            srcset="{{ section.settings.logo | image_url: width: 150 }} 1x, {{ section.settings.logo | image_url: width: 300 }} 2x"
            alt="{{ shop.name }}"
            width="{{ section.settings.logo_width | default: 150 }}"
            height="auto"
            loading="eager"
          >
        {%- else -%}
          <span class="header__logo-text">{{ shop.name }}</span>
        {%- endif -%}
      </a>
    </div>

    {% comment %} Main Navigation with Mega Menu {% endcomment %}
    <nav class="header__nav" role="navigation">
      <ul class="header__nav-list">
        {%- for link in section.settings.menu.links -%}
          <li class="header__nav-item{% if link.links.size > 0 %} has-dropdown{% endif %}">
            <a href="{{ link.url }}" class="header__nav-link{% if link.active %} is-active{% endif %}">
              {{ link.title }}
              {%- if link.links.size > 0 -%}
                <svg class="header__nav-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 12 15 18 9"/>
                </svg>
              {%- endif -%}
            </a>

            {% comment %} Dropdown / Mega Menu {% endcomment %}
            {%- if link.links.size > 0 -%}
              <div class="header__dropdown">
                <div class="header__dropdown-inner">
                  <ul class="header__dropdown-list">
                    {%- for child_link in link.links -%}
                      <li class="header__dropdown-item">
                        <a href="{{ child_link.url }}" class="header__dropdown-link">
                          {{ child_link.title }}
                        </a>

                        {% comment %} Third level links {% endcomment %}
                        {%- if child_link.links.size > 0 -%}
                          <ul class="header__dropdown-sublist">
                            {%- for grandchild_link in child_link.links -%}
                              <li>
                                <a href="{{ grandchild_link.url }}">{{ grandchild_link.title }}</a>
                              </li>
                            {%- endfor -%}
                          </ul>
                        {%- endif -%}
                      </li>
                    {%- endfor -%}
                  </ul>

                  {% comment %} Featured Content in Mega Menu {% endcomment %}
                  {%- if section.settings.mega_menu_image != blank and link.title == section.settings.mega_menu_parent -%}
                    <div class="header__dropdown-featured">
                      <a href="{{ section.settings.mega_menu_link }}">
                        <img
                          src="{{ section.settings.mega_menu_image | image_url: width: 400 }}"
                          alt="{{ section.settings.mega_menu_heading }}"
                          loading="lazy"
                        >
                        <div class="header__dropdown-featured-content">
                          <span class="header__dropdown-featured-label">{{ section.settings.mega_menu_label }}</span>
                          <h4>{{ section.settings.mega_menu_heading }}</h4>
                        </div>
                      </a>
                    </div>
                  {%- endif -%}
                </div>
              </div>
            {%- endif -%}
          </li>
        {%- endfor -%}
      </ul>
    </nav>

    {% comment %} Header Actions {% endcomment %}
    <div class="header__actions">
      {%- if section.settings.show_search -%}
        <button class="header__action-btn" data-search-toggle aria-label="Search">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="11" cy="11" r="8"/>
            <path d="m21 21-4.3-4.3"/>
          </svg>
        </button>
      {%- endif -%}

      <a href="{{ routes.account_url }}" class="header__action-btn" aria-label="Account">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
          <circle cx="12" cy="7" r="4"/>
        </svg>
        {%- if customer -%}
          <span class="header__account-indicator"></span>
        {%- endif -%}
      </a>

      <button class="header__action-btn header__cart-btn" data-cart-toggle aria-label="Cart">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/>
          <path d="M3 6h18"/>
          <path d="M16 10a4 4 0 0 1-8 0"/>
        </svg>
        <span class="header__cart-count{% if cart.item_count == 0 %} is-hidden{% endif %}" data-cart-count>
          {{ cart.item_count }}
        </span>
      </button>
    </div>
  </div>
</header>

{% comment %} Search Overlay {% endcomment %}
<div class="search-overlay" data-search-overlay>
  <div class="search-overlay__inner">
    <button class="search-overlay__close" data-search-close aria-label="Close search">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"/>
        <line x1="6" y1="6" x2="18" y2="18"/>
      </svg>
    </button>

    <form action="{{ routes.search_url }}" method="get" class="search-overlay__form" role="search">
      <input type="hidden" name="type" value="product">
      <div class="search-overlay__input-wrapper">
        <svg class="search-overlay__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <circle cx="11" cy="11" r="8"/>
          <path d="m21 21-4.3-4.3"/>
        </svg>
        <input
          type="search"
          name="q"
          class="search-overlay__input"
          placeholder="{{ section.settings.search_placeholder | default: 'Search fragrances...' }}"
          autocomplete="off"
          autocorrect="off"
          autocapitalize="off"
          data-search-input
        >
      </div>
      <button type="submit" class="btn btn--primary">Search</button>
    </form>

    <div class="search-overlay__suggestions">
      <p class="search-overlay__suggestions-title">Popular Searches</p>
      <div class="search-overlay__suggestions-list">
        <a href="{{ routes.search_url }}?q=subscription" class="search-overlay__suggestion">Subscription</a>
        <a href="{{ routes.search_url }}?q=discovery" class="search-overlay__suggestion">Discovery Set</a>
        <a href="{{ routes.search_url }}?q=woody" class="search-overlay__suggestion">Woody</a>
        <a href="{{ routes.search_url }}?q=floral" class="search-overlay__suggestion">Floral</a>
        <a href="{{ routes.search_url }}?q=fresh" class="search-overlay__suggestion">Fresh</a>
      </div>
    </div>
  </div>
</div>

{% comment %} Mobile Navigation {% endcomment %}
<div class="mobile-nav-overlay" data-mobile-overlay></div>
<nav class="mobile-nav" data-mobile-nav>
  <div class="mobile-nav__header">
    <div class="mobile-nav__logo">
      {%- if section.settings.logo != blank -%}
        <img src="{{ section.settings.logo | image_url: width: 150 }}" alt="{{ shop.name }}" width="120">
      {%- else -%}
        <span>{{ shop.name }}</span>
      {%- endif -%}
    </div>
    <button class="mobile-nav__close" data-mobile-close aria-label="Close menu">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"/>
        <line x1="6" y1="6" x2="18" y2="18"/>
      </svg>
    </button>
  </div>

  <div class="mobile-nav__search">
    <form action="{{ routes.search_url }}" method="get" role="search">
      <input type="hidden" name="type" value="product">
      <div class="mobile-nav__search-wrapper">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <circle cx="11" cy="11" r="8"/>
          <path d="m21 21-4.3-4.3"/>
        </svg>
        <input type="search" name="q" placeholder="Search fragrances...">
      </div>
    </form>
  </div>

  <ul class="mobile-nav__list">
    {%- for link in section.settings.menu.links -%}
      <li class="mobile-nav__item{% if link.links.size > 0 %} has-children{% endif %}">
        {%- if link.links.size > 0 -%}
          <button class="mobile-nav__link mobile-nav__toggle" data-mobile-submenu-toggle>
            {{ link.title }}
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"/>
            </svg>
          </button>
          <ul class="mobile-nav__submenu">
            <li class="mobile-nav__submenu-item">
              <a href="{{ link.url }}" class="mobile-nav__submenu-link mobile-nav__submenu-link--all">
                All {{ link.title }}
              </a>
            </li>
            {%- for child_link in link.links -%}
              <li class="mobile-nav__submenu-item">
                <a href="{{ child_link.url }}" class="mobile-nav__submenu-link">{{ child_link.title }}</a>
              </li>
            {%- endfor -%}
          </ul>
        {%- else -%}
          <a href="{{ link.url }}" class="mobile-nav__link">{{ link.title }}</a>
        {%- endif -%}
      </li>
    {%- endfor -%}
  </ul>

  <div class="mobile-nav__footer">
    <a href="{{ routes.account_url }}" class="mobile-nav__account">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
        <circle cx="12" cy="7" r="4"/>
      </svg>
      {%- if customer -%}
        My Account
      {%- else -%}
        Sign In / Register
      {%- endif -%}
    </a>

    {%- if section.settings.show_social_mobile -%}
      <div class="mobile-nav__social">
        {%- if settings.social_instagram != blank -%}
          <a href="{{ settings.social_instagram }}" target="_blank" rel="noopener" aria-label="Instagram">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <rect x="2" y="2" width="20" height="20" rx="5"/>
              <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/>
              <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/>
            </svg>
          </a>
        {%- endif -%}
        {%- if settings.social_tiktok != blank -%}
          <a href="{{ settings.social_tiktok }}" target="_blank" rel="noopener" aria-label="TikTok">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/>
            </svg>
          </a>
        {%- endif -%}
        {%- if settings.social_facebook != blank -%}
          <a href="{{ settings.social_facebook }}" target="_blank" rel="noopener" aria-label="Facebook">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/>
            </svg>
          </a>
        {%- endif -%}
      </div>
    {%- endif -%}
  </div>
</nav>

<style>
  /* Announcement Bar */
  .announcement-bar {
    background: var(--color-primary);
    color: white;
    padding: 10px 0;
    text-align: center;
    font-size: var(--font-size-sm);
  }

  .announcement-bar__text {
    margin: 0;
  }

  .announcement-bar__text a {
    color: inherit;
    text-decoration: underline;
    text-underline-offset: 2px;
  }

  .announcement-bar__text a:hover {
    color: var(--color-secondary);
  }

  /* Header */
  .header {
    position: relative;
    background: white;
    border-bottom: 1px solid var(--color-border);
    z-index: 100;
  }

  .header.is-sticky {
    position: sticky;
    top: 0;
  }

  .header.is-transparent {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    background: transparent;
    border-bottom: none;
  }

  .header.is-transparent .header__nav-link,
  .header.is-transparent .header__action-btn,
  .header.is-transparent .header__logo-text {
    color: white;
  }

  .header__inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--spacing-md) var(--spacing-xl);
    gap: var(--spacing-xl);
  }

  /* Logo */
  .header__logo {
    flex-shrink: 0;
  }

  .header__logo a {
    display: flex;
    align-items: center;
  }

  .header__logo img {
    display: block;
    height: auto;
  }

  .header__logo-text {
    font-size: var(--font-size-xl);
    font-weight: 700;
    color: var(--color-primary);
    letter-spacing: -0.02em;
  }

  /* Navigation */
  .header__nav {
    display: none;
    flex: 1;
    justify-content: center;
  }

  @media (min-width: 1024px) {
    .header__nav {
      display: flex;
    }
  }

  .header__nav-list {
    display: flex;
    align-items: center;
    gap: var(--spacing-lg);
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .header__nav-item {
    position: relative;
  }

  .header__nav-link {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: var(--spacing-sm) 0;
    font-size: var(--font-size-sm);
    font-weight: 500;
    color: var(--color-text);
    text-decoration: none;
    transition: color 0.2s;
  }

  .header__nav-link:hover,
  .header__nav-link.is-active {
    color: var(--color-secondary);
  }

  .header__nav-arrow {
    width: 14px;
    height: 14px;
    transition: transform 0.2s;
  }

  .header__nav-item:hover .header__nav-arrow {
    transform: rotate(180deg);
  }

  /* Dropdown Menu */
  .header__dropdown {
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    padding-top: var(--spacing-sm);
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.2s, visibility 0.2s;
  }

  .header__nav-item:hover .header__dropdown {
    opacity: 1;
    visibility: visible;
  }

  .header__dropdown-inner {
    display: flex;
    gap: var(--spacing-xl);
    background: white;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-xl);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
    min-width: 200px;
  }

  .header__dropdown-list {
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .header__dropdown-item {
    margin-bottom: var(--spacing-sm);
  }

  .header__dropdown-item:last-child {
    margin-bottom: 0;
  }

  .header__dropdown-link {
    display: block;
    padding: var(--spacing-xs) 0;
    font-size: var(--font-size-sm);
    color: var(--color-text);
    text-decoration: none;
    font-weight: 500;
    white-space: nowrap;
    transition: color 0.2s;
  }

  .header__dropdown-link:hover {
    color: var(--color-secondary);
  }

  .header__dropdown-sublist {
    list-style: none;
    margin: var(--spacing-xs) 0 0;
    padding-left: var(--spacing-md);
  }

  .header__dropdown-sublist a {
    display: block;
    padding: var(--spacing-xs) 0;
    font-size: var(--font-size-xs);
    color: var(--color-text-light);
    text-decoration: none;
    transition: color 0.2s;
  }

  .header__dropdown-sublist a:hover {
    color: var(--color-secondary);
  }

  /* Dropdown Featured */
  .header__dropdown-featured {
    width: 200px;
    flex-shrink: 0;
  }

  .header__dropdown-featured a {
    display: block;
    text-decoration: none;
    border-radius: var(--radius-md);
    overflow: hidden;
  }

  .header__dropdown-featured img {
    width: 100%;
    height: 150px;
    object-fit: cover;
  }

  .header__dropdown-featured-content {
    padding: var(--spacing-md);
    background: var(--color-background-secondary);
  }

  .header__dropdown-featured-label {
    display: block;
    font-size: var(--font-size-xs);
    color: var(--color-secondary);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: var(--spacing-xs);
  }

  .header__dropdown-featured h4 {
    font-size: var(--font-size-sm);
    margin: 0;
    color: var(--color-primary);
  }

  /* Header Actions */
  .header__actions {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
  }

  .header__action-btn {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 44px;
    height: 44px;
    background: transparent;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    color: var(--color-text);
    transition: background 0.2s, color 0.2s;
  }

  .header__action-btn:hover {
    background: var(--color-background-secondary);
  }

  .header__action-btn svg {
    width: 22px;
    height: 22px;
  }

  .header__cart-count {
    position: absolute;
    top: 4px;
    right: 4px;
    min-width: 18px;
    height: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--color-secondary);
    color: var(--color-primary);
    font-size: 11px;
    font-weight: 700;
    border-radius: var(--radius-full);
    padding: 0 4px;
  }

  .header__cart-count.is-hidden {
    display: none;
  }

  .header__account-indicator {
    position: absolute;
    bottom: 8px;
    right: 8px;
    width: 8px;
    height: 8px;
    background: var(--color-success);
    border-radius: 50%;
    border: 2px solid white;
  }

  /* Mobile Menu Toggle */
  .header__menu-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 44px;
    height: 44px;
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 0;
  }

  @media (min-width: 1024px) {
    .header__menu-toggle {
      display: none;
    }
  }

  .header__hamburger {
    display: flex;
    flex-direction: column;
    gap: 5px;
    width: 20px;
  }

  .header__hamburger span {
    display: block;
    height: 2px;
    background: var(--color-text);
    border-radius: 1px;
    transition: transform 0.2s, opacity 0.2s;
  }

  .header.is-transparent .header__hamburger span {
    background: white;
  }

  /* Search Overlay */
  .search-overlay {
    position: fixed;
    inset: 0;
    z-index: 1000;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(4px);
    display: none;
    align-items: flex-start;
    justify-content: center;
    padding: var(--spacing-3xl);
  }

  .search-overlay.is-active {
    display: flex;
  }

  .search-overlay__inner {
    width: 100%;
    max-width: 600px;
    background: white;
    border-radius: var(--radius-lg);
    padding: var(--spacing-2xl);
    animation: searchSlideIn 0.3s ease;
  }

  @keyframes searchSlideIn {
    from {
      opacity: 0;
      transform: translateY(-20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .search-overlay__close {
    position: absolute;
    top: var(--spacing-lg);
    right: var(--spacing-lg);
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    color: var(--color-text);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    transition: transform 0.2s;
  }

  .search-overlay__close:hover {
    transform: scale(1.1);
  }

  .search-overlay__close svg {
    width: 20px;
    height: 20px;
  }

  .search-overlay__form {
    display: flex;
    gap: var(--spacing-md);
  }

  .search-overlay__input-wrapper {
    flex: 1;
    position: relative;
  }

  .search-overlay__icon {
    position: absolute;
    left: var(--spacing-md);
    top: 50%;
    transform: translateY(-50%);
    width: 20px;
    height: 20px;
    color: var(--color-text-muted);
    pointer-events: none;
  }

  .search-overlay__input {
    width: 100%;
    padding: var(--spacing-md) var(--spacing-md) var(--spacing-md) 48px;
    font-size: var(--font-size-base);
    border: 2px solid var(--color-border);
    border-radius: var(--radius-sm);
    transition: border-color 0.2s;
  }

  .search-overlay__input:focus {
    outline: none;
    border-color: var(--color-secondary);
  }

  .search-overlay__suggestions {
    margin-top: var(--spacing-xl);
    padding-top: var(--spacing-xl);
    border-top: 1px solid var(--color-border);
  }

  .search-overlay__suggestions-title {
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
    margin-bottom: var(--spacing-md);
  }

  .search-overlay__suggestions-list {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-sm);
  }

  .search-overlay__suggestion {
    display: inline-block;
    padding: var(--spacing-xs) var(--spacing-md);
    background: var(--color-background-secondary);
    border-radius: var(--radius-full);
    font-size: var(--font-size-sm);
    color: var(--color-text);
    text-decoration: none;
    transition: background 0.2s;
  }

  .search-overlay__suggestion:hover {
    background: var(--color-secondary);
    color: var(--color-primary);
  }

  /* Mobile Navigation */
  .mobile-nav-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 999;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s, visibility 0.3s;
  }

  .mobile-nav-overlay.is-active {
    opacity: 1;
    visibility: visible;
  }

  .mobile-nav {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    width: 320px;
    max-width: 85vw;
    background: white;
    z-index: 1000;
    display: flex;
    flex-direction: column;
    transform: translateX(-100%);
    transition: transform 0.3s ease;
  }

  .mobile-nav.is-active {
    transform: translateX(0);
  }

  .mobile-nav__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--spacing-lg);
    border-bottom: 1px solid var(--color-border);
  }

  .mobile-nav__logo {
    font-size: var(--font-size-lg);
    font-weight: 700;
  }

  .mobile-nav__logo img {
    height: 32px;
    width: auto;
  }

  .mobile-nav__close {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: transparent;
    border: none;
    cursor: pointer;
    color: var(--color-text);
  }

  .mobile-nav__close svg {
    width: 24px;
    height: 24px;
  }

  .mobile-nav__search {
    padding: var(--spacing-md) var(--spacing-lg);
    border-bottom: 1px solid var(--color-border);
  }

  .mobile-nav__search-wrapper {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-sm) var(--spacing-md);
    background: var(--color-background-secondary);
    border-radius: var(--radius-sm);
  }

  .mobile-nav__search-wrapper svg {
    width: 18px;
    height: 18px;
    color: var(--color-text-muted);
    flex-shrink: 0;
  }

  .mobile-nav__search-wrapper input {
    flex: 1;
    border: none;
    background: transparent;
    font-size: var(--font-size-sm);
    padding: var(--spacing-xs) 0;
  }

  .mobile-nav__search-wrapper input:focus {
    outline: none;
  }

  .mobile-nav__list {
    flex: 1;
    overflow-y: auto;
    list-style: none;
    margin: 0;
    padding: var(--spacing-md) 0;
  }

  .mobile-nav__item {
    border-bottom: 1px solid var(--color-border);
  }

  .mobile-nav__link {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    padding: var(--spacing-md) var(--spacing-lg);
    font-size: var(--font-size-base);
    font-weight: 500;
    color: var(--color-text);
    text-decoration: none;
    background: transparent;
    border: none;
    cursor: pointer;
    text-align: left;
  }

  .mobile-nav__toggle svg {
    width: 20px;
    height: 20px;
    transition: transform 0.2s;
  }

  .mobile-nav__item.is-open .mobile-nav__toggle svg {
    transform: rotate(180deg);
  }

  .mobile-nav__submenu {
    display: none;
    list-style: none;
    margin: 0;
    padding: 0 0 var(--spacing-md);
    background: var(--color-background-secondary);
  }

  .mobile-nav__item.is-open .mobile-nav__submenu {
    display: block;
  }

  .mobile-nav__submenu-link {
    display: block;
    padding: var(--spacing-sm) var(--spacing-lg) var(--spacing-sm) var(--spacing-2xl);
    font-size: var(--font-size-sm);
    color: var(--color-text-light);
    text-decoration: none;
  }

  .mobile-nav__submenu-link--all {
    font-weight: 600;
    color: var(--color-secondary);
  }

  .mobile-nav__footer {
    padding: var(--spacing-lg);
    border-top: 1px solid var(--color-border);
  }

  .mobile-nav__account {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-md);
    background: var(--color-background-secondary);
    border-radius: var(--radius-sm);
    font-size: var(--font-size-sm);
    font-weight: 500;
    color: var(--color-text);
    text-decoration: none;
    margin-bottom: var(--spacing-lg);
  }

  .mobile-nav__account svg {
    width: 20px;
    height: 20px;
  }

  .mobile-nav__social {
    display: flex;
    justify-content: center;
    gap: var(--spacing-md);
  }

  .mobile-nav__social a {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: var(--color-background-secondary);
    border-radius: 50%;
    color: var(--color-text);
    transition: background 0.2s, color 0.2s;
  }

  .mobile-nav__social a:hover {
    background: var(--color-primary);
    color: white;
  }

  .mobile-nav__social svg {
    width: 18px;
    height: 18px;
  }

  @media (max-width: 480px) {
    .search-overlay {
      padding: var(--spacing-xl) var(--spacing-md);
    }

    .search-overlay__form {
      flex-direction: column;
    }
  }
</style>

<script>
  (function() {
    // Mobile Navigation
    const mobileToggle = document.querySelector('[data-mobile-toggle]');
    const mobileNav = document.querySelector('[data-mobile-nav]');
    const mobileOverlay = document.querySelector('[data-mobile-overlay]');
    const mobileClose = document.querySelector('[data-mobile-close]');
    const submenuToggles = document.querySelectorAll('[data-mobile-submenu-toggle]');

    function openMobileNav() {
      mobileNav.classList.add('is-active');
      mobileOverlay.classList.add('is-active');
      document.body.style.overflow = 'hidden';
    }

    function closeMobileNav() {
      mobileNav.classList.remove('is-active');
      mobileOverlay.classList.remove('is-active');
      document.body.style.overflow = '';
    }

    if (mobileToggle) {
      mobileToggle.addEventListener('click', openMobileNav);
    }

    if (mobileClose) {
      mobileClose.addEventListener('click', closeMobileNav);
    }

    if (mobileOverlay) {
      mobileOverlay.addEventListener('click', closeMobileNav);
    }

    submenuToggles.forEach(function(toggle) {
      toggle.addEventListener('click', function() {
        const parent = toggle.closest('.mobile-nav__item');
        parent.classList.toggle('is-open');
      });
    });

    // Search Overlay
    const searchToggle = document.querySelector('[data-search-toggle]');
    const searchOverlay = document.querySelector('[data-search-overlay]');
    const searchClose = document.querySelector('[data-search-close]');
    const searchInput = document.querySelector('[data-search-input]');

    function openSearch() {
      searchOverlay.classList.add('is-active');
      document.body.style.overflow = 'hidden';
      setTimeout(function() {
        searchInput.focus();
      }, 100);
    }

    function closeSearch() {
      searchOverlay.classList.remove('is-active');
      document.body.style.overflow = '';
    }

    if (searchToggle) {
      searchToggle.addEventListener('click', openSearch);
    }

    if (searchClose) {
      searchClose.addEventListener('click', closeSearch);
    }

    if (searchOverlay) {
      searchOverlay.addEventListener('click', function(e) {
        if (e.target === searchOverlay) {
          closeSearch();
        }
      });
    }

    // Close on escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeMobileNav();
        closeSearch();
      }
    });

    // Sticky Header scroll behavior
    const header = document.querySelector('[data-header]');
    if (header && header.classList.contains('is-sticky')) {
      let lastScroll = 0;

      window.addEventListener('scroll', function() {
        const currentScroll = window.pageYOffset;

        if (currentScroll <= 0) {
          header.classList.remove('is-scrolled', 'is-hidden');
          return;
        }

        if (currentScroll > lastScroll && currentScroll > 100) {
          // Scrolling down
          header.classList.add('is-hidden');
        } else {
          // Scrolling up
          header.classList.remove('is-hidden');
          header.classList.add('is-scrolled');
        }

        lastScroll = currentScroll;
      });
    }

    // Handle transparent header on scroll
    if (header && header.classList.contains('is-transparent')) {
      window.addEventListener('scroll', function() {
        if (window.pageYOffset > 50) {
          header.classList.add('is-scrolled');
          header.classList.remove('is-transparent');
        } else {
          header.classList.remove('is-scrolled');
          header.classList.add('is-transparent');
        }
      });
    }
  })();
</script>

{% schema %}
{
  "name": "Header",
  "class": "header-section",
  "settings": [
    {
      "type": "header",
      "content": "Announcement Bar"
    },
    {
      "type": "checkbox",
      "id": "announcement_enabled",
      "label": "Enable announcement bar",
      "default": true
    },
    {
      "type": "text",
      "id": "announcement_text",
      "label": "Announcement text",
      "default": "Free shipping on subscription orders | Subscribe & save 15%"
    },
    {
      "type": "url",
      "id": "announcement_link",
      "label": "Announcement link"
    },
    {
      "type": "header",
      "content": "Logo"
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo image"
    },
    {
      "type": "range",
      "id": "logo_width",
      "label": "Logo width",
      "min": 80,
      "max": 200,
      "step": 10,
      "unit": "px",
      "default": 150
    },
    {
      "type": "header",
      "content": "Navigation"
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Menu",
      "default": "main-menu"
    },
    {
      "type": "header",
      "content": "Mega Menu Featured"
    },
    {
      "type": "text",
      "id": "mega_menu_parent",
      "label": "Parent menu title",
      "info": "Enter the exact title of the menu item to show featured content"
    },
    {
      "type": "image_picker",
      "id": "mega_menu_image",
      "label": "Featured image"
    },
    {
      "type": "text",
      "id": "mega_menu_label",
      "label": "Featured label",
      "default": "New"
    },
    {
      "type": "text",
      "id": "mega_menu_heading",
      "label": "Featured heading",
      "default": "Summer Collection"
    },
    {
      "type": "url",
      "id": "mega_menu_link",
      "label": "Featured link"
    },
    {
      "type": "header",
      "content": "Header Options"
    },
    {
      "type": "checkbox",
      "id": "sticky_header",
      "label": "Enable sticky header",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "transparent_on_homepage",
      "label": "Transparent header on homepage",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_search",
      "label": "Show search icon",
      "default": true
    },
    {
      "type": "text",
      "id": "search_placeholder",
      "label": "Search placeholder text",
      "default": "Search fragrances..."
    },
    {
      "type": "checkbox",
      "id": "show_social_mobile",
      "label": "Show social links in mobile menu",
      "default": true
    }
  ]
}
{% endschema %}
